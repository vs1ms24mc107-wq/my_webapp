pipeline {
	agent any
	environment {
		DOCKERHUB_CRED=credentials('vd')
		IMAGE_NAME="vs1ms24mc107/flasskk"
	}
	
	stages {
		stage('checkout') {
			steps {
				git url:'git@github.com:vs1ms24mc107-wq/my_webapp.git', branch:'main' 
			}
		}
		
		stage('Build Docker Image') {
			steps {
				script {
					dockerImage=docker.build("${IMAGE_NAME}:latest")
				}
			}
		}
		
		stage('Push to DockerHub') {
			steps {
				script {
					docker.withRegistry('https://index.docker.io/v1/','vd') {
						dockerImage.push()
					}
				}
			}
		}
	}
	
	post {
		success {
			echo "Pipeline Successful"
		}
		failure {
			echo "Pipeline Failed"
		}
		always {
			echo "Cleaning Up WorkSpace"
			deleteDir()
		}
	}
}
